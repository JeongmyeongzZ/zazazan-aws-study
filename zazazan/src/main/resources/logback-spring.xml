<configuration>
    <springProperty name="spring.profiles.active" source="spring.profiles.active"/>
    <springProperty name="filebeat.file" source="filebeat.file" defaultValue="/tmp/service.log"/>
    <springProperty name="LOG_FILE" source="logging.file.name" defaultValue="/tmp/application.log"/>

    <include resource="org/springframework/boot/logging/logback/defaults.xml" />
    <include resource="org/springframework/boot/logging/logback/file-appender.xml" />

    <appender name="stash" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>info</level>
        </filter>
        <file>${filebeat.file}</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${filebeat.file}.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
            <maxFileSize>10MB</maxFileSize>
            <maxHistory>7</maxHistory>
            <totalSizeCap>1GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%date %level [%thread] %msg%n</pattern>
        </encoder>
<!--        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">-->
<!--            <providers>-->
<!--                <pattern>-->
<!--                    <pattern>-->
<!--                        {-->
<!--                        "header": {-->
<!--                        "env": "${spring.profiles.active:prod}",-->
<!--                        "log_level": "%level"-->
<!--                        },-->
<!--                        "payload": "#tryJson{%message}"-->
<!--                        }-->
<!--                    </pattern>-->
<!--                </pattern>-->
<!--            </providers>-->
<!--        </encoder>-->
    </appender>

<!--    <appender name="FILE_JSON"-->
<!--              class="ch.qos.logback.core.rolling.RollingFileAppender">-->
<!--        <file>${LOG_FILE}.json</file>-->
<!--        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">-->
<!--            <fileNamePattern>${LOG_FILE}.json.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>-->
<!--            <maxFileSize>${LOG_FILE_MAX_SIZE:100MB}</maxFileSize>-->
<!--            <maxHistory>${LOG_FILE_MAX_HISTORY:10}</maxHistory>-->
<!--            <totalSizeCap>1GB</totalSizeCap>-->
<!--        </rollingPolicy>-->
<!--        <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>-->
<!--    </appender>-->

<!--    <appender name="CONSOLE_JSON" class="ch.qos.logback.core.ConsoleAppender">-->
<!--        <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>-->
<!--    </appender>-->

    <logger name="filebeat" level="info">
        <appender-ref ref="stash"/>
    </logger>

<!--    <root level="INFO">-->
<!--        <appender-ref ref="CONSOLE_JSON"/>-->
<!--        <appender-ref ref="FILE"/>-->
<!--        <appender-ref ref="FILE_JSON"/>-->
<!--    </root>-->
</configuration>
